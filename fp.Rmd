---
title: "Untitled"
author: "Doeun Kim"
date: "June 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plotly)
```

## Problem
Traffic accident has been one of the unresolvable social problems of all national governments. As far as I know, Korea, the country where I originally come from, is desperately striving with reducing the number of traffic accidents, but it seems hard to reduce it. I assume that the government needs more data analysis in order to figure out the main causes. Therefore, I prepared this analysis in order to figure out what kind of person mainly causes what kind of traffic accident in which place and on what day, time, and weather based on the collected traffic accidents data in Korea in 2016, which is the latest.

## Who

```{r}
library(plotly)
age_by_month <- read.csv("data/2016-inflictor-driver-by-age-and-month.csv")
months <- c('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December')

below20 <- c()
from21to30 <- c()
from31to40 <- c()
from41to50 <- c()
from51to60 <- c()
from61to70 <- c()
above71 <- c()
for(name in names(age_by_month)){
  if(name != "X" & name != "X.1" & name != "total"){
    below20 <- c(below20, as.numeric(as.character(age_by_month[age_by_month$X=="below-14" & age_by_month$X.1=="accident", ][[name]])) + as.numeric(as.character(age_by_month[age_by_month$X=="15~20" & age_by_month$X.1=="accident", ][[name]])))
    from21to30 <- c(from21to30, as.numeric(as.character(age_by_month[age_by_month$X=="21~30" & age_by_month$X.1=="accident", ][[name]])))
    from31to40 <- c(from31to40, as.numeric(as.character(age_by_month[age_by_month$X=="31~40" & age_by_month$X.1=="accident", ][[name]])))
    from41to50 <- c(from41to50, as.numeric(as.character(age_by_month[age_by_month$X=="41~50" & age_by_month$X.1=="accident", ][[name]])))
    from51to60 <- c(from51to60, as.numeric(as.character(age_by_month[age_by_month$X=="51~60" & age_by_month$X.1=="accident", ][[name]])))
    from61to70 <- c(from61to70, as.numeric(as.character(age_by_month[age_by_month$X=="61~64" & age_by_month$X.1=="accident", ][[name]]))+as.numeric(as.character(age_by_month[age_by_month$X=="65~70" & age_by_month$X.1=="accident", ][[name]])))
    above71 <- c(above71, as.numeric(as.character(age_by_month[age_by_month$X=="above-71" & age_by_month$X.1=="accident", ][[name]])))
  }
}

data <- data.frame(months, below20,from21to30, from31to40, from41to50, from51to60, from61to70, above71)

#The default order will be alphabetized unless specified as below:
data$months <- factor(data$months, levels = data[["months"]])

plot_ly(data, x = ~months, y = ~below20, name = 'below 20', type = 'scatter', mode = 'lines',
        line = list(color = 'red', width = 4)) %>%
  add_trace(y = ~from21to30, name = '21~30', line = list(color = 'green', width = 4)) %>%
  add_trace(y = ~from31to40, name = '31~40', line = list(color = 'blue', width = 4)) %>%
  add_trace(y = ~from41to50, name = '41~50', line = list(color = 'pink', width = 4)) %>%
  add_trace(y = ~from51to60, name = '51~60', line = list(color = 'black', width = 4)) %>%
  add_trace(y = ~from61to70, name = '61~70', line = list(color = 'purple', width = 4)) %>%
  add_trace(y = ~above71, name = 'above 71', line = list(color = 'orange', width = 4)) %>%
  layout(title = "Age vs Month vs Number of Traffic Accidents",
         xaxis = list(title = "", tickangle = -45),
         yaxis = list (title = "Accidents"), margin = list(b = 70))

```
```{r}
drunken_by_time <- read.csv("data/2016-inflictor-driver-by-drunken-rate-day-and-night.csv")
times <- c("Day","Night")
from0.05to0.09 <- c()
from0.10to0.14 <- c()
from0.15to0.19 <- c()
from0.20to0.24 <- c()
from0.25to0.29 <- c()
from0.30to0.34 <- c()
above0.35 <- c()
for(name in names(drunken_by_time)){
  if(name != "X" & name != "X.1" & name != "total"){
    from0.05to0.09 <- c(from0.05to0.09, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="0.05%~0.09%" & drunken_by_time$X.1=="accident", ][[name]])))
    from0.10to0.14 <- c(from0.10to0.14, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="0.10%~0.14%" & drunken_by_time$X.1=="accident", ][[name]])))
    from0.15to0.19 <- c(from0.15to0.19, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="0.15%~0.19%" & drunken_by_time$X.1=="accident", ][[name]])))
    from0.20to0.24 <- c(from0.20to0.24, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="0.20%~0.24%" & drunken_by_time$X.1=="accident", ][[name]])))
    from0.25to0.29 <- c(from0.25to0.29, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="0.25%~0.29%" & drunken_by_time$X.1=="accident", ][[name]])))
    from0.30to0.34 <- c(from0.30to0.34, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="0.30%~0.34%" & drunken_by_time$X.1=="accident", ][[name]])))
    above0.35 <- c(above0.35, as.numeric(as.character(drunken_by_time[drunken_by_time$X=="above-0.35%" & drunken_by_time$X.1=="accident", ][[name]])))
  }
}
data <- data.frame(times, from0.05to0.09, from0.10to0.14, from0.15to0.19, from0.20to0.24, from0.25to0.29, from0.30to0.34, above0.35)

plot_ly(data, x = ~times, y = ~from0.05to0.09, type = 'bar', name = '0.05%~0.09%') %>%
  add_trace(y = ~from0.10to0.14, name = '0.10%~0.14%') %>% add_trace(y = ~from0.15to0.19, name = '0.15%~0.19%') %>% add_trace(y = ~from0.20to0.24, name = '0.20%~0.24%') %>% add_trace(y = ~from0.25to0.29, name = '0.25%~0.29%') %>% add_trace(y = ~from0.30to0.34, name = '0.30%~0.34%') %>% add_trace(y = ~above0.35, name = 'above 0.39%') %>% 
  layout(title="Blood Alcohol Content vs Day-Night vs Number of Traffic Accidents",xaxis = list(title = ""),yaxis = list(title = 'Accidents'), barmode = 'group')
```

```{r}
law_violation <- read.csv("data/2016-inflictor-drivers-by-law-violation.csv")
types <- c("overwork","overspeed","violate-overtaking-method","violate-overtaking-ban","drive-over-centerline","violate-traffic-light","unobtain-safe-distance","vioate-pause-and-slow-speed","improper-rotation","violate-pass-first-priority","break-yield-duty","break-safe-drive-duty","violate-intersection-passing-method","violate-pedestrian-protection-duty","violate-path-change","straight-and-right-turn-traffic-obstruction","violate-railroad-crossing-method","violate-obligation-to-pay-for-emergency-cars","violate-driving-prohibition-of-poor-maintenance","pedestrian-fault","etc")
day_data <- c('etc' = 0)
night_data <- c('etc'= 0)
for(type in types){
  day <- as.numeric(as.character(law_violation[law_violation$X==type & law_violation$X.1=="accident", ][["day"]]))
  night <- as.numeric(as.character(law_violation[law_violation$X==type & law_violation$X.1=="accident", ][["night"]]))
  if(type != 'etc' & day > 1000){
    day_data[type] <- day
  }
  else{
    day_data['etc'] <- day_data['etc'] + day
  }
  if(type != 'etc' & night > 1000){
    night_data[type] <- night
  }
  else{
    night_data['etc'] <- night_data['etc'] + night
  }
}
day_data <- data.frame(day_data)
day_data <- data.frame("Categorie"=rownames(day_data),day_data)
data <- day_data[, c("Categorie","day_data")]
colors <- c('#ffb3ba','#ffdfba','#ffffba','#baffc9','#bae1ff','#ffeaff','#ffeaea','#ecb7ea','#f5f0ff','#f0fcff','#f0f6ff',' #f2adde','#f2e8ad','#adc3f2','#ecb7ea','#d2adf2','#f9c35c','#cae3e0','#ffe6cc','#e6e6e6','#c5ae8c')
plot_ly(data, labels=~Categorie, values = ~day_data, type="pie", textinfo = "label+percent", textposition="inside",insidetextfont = list(color="#000000"),marker = list(colors=colors, line = list(color = "#000000", width=1)), showlegend = FALSE)%>%
  layout(title="Types of Law Violation at Day Time", xaxis = list(showgrid=FALSE, zeroline = FALSE, showticklabels = FALSE), yaxis = list(showgrid=FALSE, zeroline=FALSE, showticklabels=FALSE))
plot_ly(data, labels=~Categorie, values = ~night_data, type="pie", textinfo = "label+percent", textposition="inside",insidetextfont = list(color="#000000"),marker = list(colors=colors, line = list(color = "#000000", width=1)), showlegend = FALSE)%>%
  layout(title="Types of Law Violation at Night Time", xaxis = list(showgrid=FALSE, zeroline = FALSE, showticklabels = FALSE), yaxis = list(showgrid=FALSE, zeroline=FALSE, showticklabels=FALSE))
```

```{r}
accident_types <- read.csv("data/2016-by-accident-type-and-inflictor-driver-age.csv",header=F)
car_to_person<- c("walking across", "passing roadway", "passing the edge of the road area", "passing sidewalk")
ages <- c("below 20", "21~30","31~40","41~50","51~60","above 60")

walking_across <- as.numeric(accident_types[2,3:8])
passing_roadway <- as.numeric(accident_types[3,3:8])
passing_the_edge_of_the_road_area <- as.numeric(accident_types[4,3:8])
passing_sidewalk <- as.numeric(accident_types[5,3:8])
data <- data.frame(ages, walking_across, passing_roadway,passing_the_edge_of_the_road_area,passing_sidewalk)
#The default order will be alphabetized unless specified as below:
data$ages <- factor(data$ages, levels = data[["ages"]])
plot_ly(data, x = ~ages, y = ~walking_across, type = 'bar', name = 'walking across') %>%
  add_trace(y = ~passing_roadway, name = 'passing roadway') %>%
  add_trace(y = ~passing_the_edge_of_the_road_area, name = 'passing the edge of the road area') %>%
  add_trace(y = ~passing_sidewalk, name = 'passing sidewalk') %>%
  layout(title="Car to Person", xaxis = list(title="Ages"),yaxis = list(title = 'Accidents'), barmode = 'stack')

```

```{r}
frontal_collision <- as.numeric(accident_types[7,3:8])
side_right_angle_collision <- as.numeric(accident_types[8,3:8])
bump <- as.numeric(accident_types[9,3:8])
data <- data.frame(ages, frontal_collision, side_right_angle_collision,bump)
#The default order will be alphabetized unless specified as below:
data$ages <- factor(data$ages, levels = data[["ages"]])
plot_ly(data, x = ~ages, y = ~frontal_collision, type = 'bar', name = 'frontal collision') %>%
  add_trace(y = ~side_right_angle_collision, name = 'side right angle collision') %>%
  add_trace(y = ~bump, name = 'bump') %>%
  layout(title="Car to Car", xaxis = list(title="Ages"),yaxis = list(title = 'Accidents'), barmode = 'stack')
```

```{r}
workpiece_collision <- as.numeric(accident_types[11,3:8])
out_of_the_way <- as.numeric(accident_types[12,3:8])
parked_stopped_car_collsion <- as.numeric(accident_types[13,3:8])
overturn <- as.numeric(accident_types[14,3:8])
data <- data.frame(ages, workpiece_collision, out_of_the_way,parked_stopped_car_collsion,overturn)
#The default order will be alphabetized unless specified as below:
data$ages <- factor(data$ages, levels = data[["ages"]])
plot_ly(data, x = ~ages, y = ~workpiece_collision, type = 'bar', name = 'workpiece collision') %>%
  add_trace(y = ~out_of_the_way, name = 'out of the way') %>%
  add_trace(y = ~parked_stopped_car_collsion, name = 'parked/stopped car collsion') %>%
  add_trace(y = ~overturn, name = 'overturn') %>%
  layout(title="Car to Car", xaxis = list(title="Ages"),yaxis = list(title = 'Accidents'), barmode = 'stack')
```

```{r}
```

```{r}
```